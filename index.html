<html>

<head>
    <title>Flow of College Students from State to State</title>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="state_location_data.js"></script>
    <script src="Data/state_data.js"></script>
    <style>
        body {
            font-family: "Helvetica Neue", Helvetica, sans-serif;
        }

        #scale {
            width: 600px;
            height: 30px;
            margin-top: 10px;
            background: linear-gradient(to right, blue, black, red);
        }

        h1 {
            margin-bottom: 0;
        }

        .indicator {
            color: white;
            padding: 4px;
        }

        #left {
            float: left;
        }

        #right {
            float: right;
        }

        #selection {
            font-size: inherit;
            background: transparent;
            -webkit-appearance: none;
            padding: 1px;
        }
    </style>
</head>

<body>
    <h1>Number of Students
      <select id="selection" onchange="toggle();">
      <option>Leaving</option><option>Entering</option></select> Each State for College
    </h1>
    <br/>
    <script>
        nums = [];
        for (var st in state_data) {
            if (state_data.hasOwnProperty(st)) {
                nums.push(state_data[st]["leaving"].data.perc);
            }
        }
        console.log(nums.sort(function(a, b) {
            return (parseInt(a) < parseInt(b)) ? -1 : 1;
        }));
        // Build the map
        var width = 1000;
        height = 500;

        var svg = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        var g = svg.append("g");

        var projection = d3.geo.albersUsa()
            .scale(1000)
            .translate([width / 2, height / 2]);

        var geoPath = d3.geo.path()
            .projection(projection);

        // From data set
        var totalLeaving = 260042;
        var avgLeavingFactor = 0.02;
        var totalCollegePop = 932902;
        var avgLeavingPerc = 36.490196078431374;

        var showLeave = true;
        var showEnter = false;
        var arr = [];
        g.selectAll("path")
            .data(stateshighres.features)
            .enter()
            .append("path")
            .attr("fill", getFill)
            .attr("d", geoPath);

        function getFill(d) {
            var name = d.properties.NAME;
            var data = state_data[name];
            var entering = data["entering"].data / totalLeaving - avgLeavingFactor; // 0.02 is "average"
            arr.push(entering);
            var enteringFactor = Math.floor(entering * 45 * 255);
            var leaving = (data["leaving"].data.perc - avgLeavingPerc) / 100;
            var leavingFactor = Math.floor(leaving * 5 * 255);
            console.log(leaving);
            if (showLeave) {
                return "rgb(" + leavingFactor + ", 0, " + (-1 * leavingFactor) + ")";
            } else if (showEnter) {
                return "rgb(" + enteringFactor + ", 0, " + (-1 * enteringFactor) + ")";
            }
        }

        function toggle() {
            var current = document.getElementById("selection").value;
            showLeave = (current == "Leaving");
            showEnter = (current == "Entering");
            console.log(showLeave);
            recalc();
        }

        function recalc() {
            g.selectAll("path").remove();
            g.selectAll("path")
                .data(stateshighres.features)
                .enter()
                .append("path")
                .attr("fill", getFill)
                .attr("d", geoPath);
        }
    </script>
    <div id="scale"><span id="left" class="indicator">Less than average</span><span id="right" class="indicator">Greater than average</span></div><br/>
</body>

</html>
